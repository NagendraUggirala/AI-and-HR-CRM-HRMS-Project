import React, { useState, useEffect, useRef } from 'react';
import { Icon } from '@iconify/react/dist/iconify.js';
import RecruiterDashboardLayout from '../../recruiterDashboard/RecruiterDashboardLayout';
import * as XLSX from 'xlsx';
import { saveAs } from 'file-saver';
import { PDFDocument, rgb, StandardFonts } from 'pdf-lib';

const Salaryslip = () => {
  const [isLoading, setIsLoading] = useState(true);
  const [activeTab, setActiveTab] = useState('generate');
  const [selectedMonth, setSelectedMonth] = useState('2024-03');
  const [selectedEmployee, setSelectedEmployee] = useState(null);
  const [distributionMethod, setDistributionMethod] = useState('email');
  const [passwordProtect, setPasswordProtect] = useState(true);
  const [generationStatus, setGenerationStatus] = useState('idle');
  const [searchTerm, setSearchTerm] = useState('');
  const [showPreview, setShowPreview] = useState(false);
  const [showBulkDialog, setShowBulkDialog] = useState(false);
  const [showSettingsDialog, setShowSettingsDialog] = useState(false);
  const [selectedSlips, setSelectedSlips] = useState([]);
  const [emailTemplate, setEmailTemplate] = useState('');
  const [companySettings, setCompanySettings] = useState({
    name: 'TechCorp Global Solutions',
    address: '123 Tech Park, Silicon Valley, CA 94000',
    logo: 'https://api.dicebear.com/7.x/shapes/svg?seed=TechCorp',
    signatory: 'Lisa Wilson - HR Director',
    seal: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Seal',
    footerText: 'Generated by HRMS Salary Slip System v2.0',
    confidentiality: 'This document is confidential and intended only for the employee. Unauthorized distribution is prohibited.',
    autoEmail: true,
    smsNotification: true,
    defaultPassword: 'employee_id',
    emailSubject: 'Your Salary Slip for [Month Year]',
    emailBody: `Dear [Employee Name],

Your salary slip for [Month Year] has been generated.

Net Salary: [Net Amount]
Payment Date: [Payment Date]

You can download your salary slip from the employee portal or it is attached to this email.

Password: [Password]

Best regards,
HR Department`,
    retentionPeriod: 12,
    allowRevisions: true,
    revisionDays: 7
  });
  
  const [notificationSettings, setNotificationSettings] = useState({
    email: true,
    sms: true,
    portal: true,
    autoSend: true,
    sendTime: '09:00',
    ccHR: true,
    bccAccounts: false
  });

  const [bulkOptions, setBulkOptions] = useState({
    month: 'all',
    format: 'zip',
    includePassword: true,
    compress: true
  });

  const slipPreviewRef = useRef(null);

  // Sample data with more employees
  const [salaryData, setSalaryData] = useState({
    employees: [
      {
        id: 'E0001',
        name: 'Sarah Johnson',
        department: 'Executive',
        designation: 'Chief Executive Officer',
        email: 'sarah.johnson@company.com',
        phone: '+1 (555) 111-1111',
        joinDate: '2020-01-15',
        dob: '1985-03-01',
        panNumber: 'ABCDE1234F',
        uanNumber: '100123456789',
        bankDetails: {
          accountNumber: 'XXXX-XXXX-7890',
          bankName: 'Global Bank',
          ifscCode: 'GLBL0001234',
          branch: 'New York'
        },
        salaryStructure: {
          basic: 250000,
          hra: 125000,
          da: 50000,
          specialAllowance: 75000,
          medicalAllowance: 15000,
          conveyance: 8000,
          otherAllowances: 17000,
          bonus: 50000,
          overtime: 0
        },
        deductions: {
          pfEmployee: 30000,
          pfEmployer: 30000,
          esiEmployee: 2250,
          esiEmployer: 4500,
          professionalTax: 2500,
          tds: 35000,
          loanEmi: 0,
          otherDeductions: 0
        },
        attendance: {
          present: 22,
          casualLeave: 2,
          sickLeave: 0,
          paidLeave: 0,
          holidays: 4,
          weeklyOff: 8,
          overtimeHours: 8
        },
        leaveBalance: {
          earnedLeave: 12,
          casualLeave: 8,
          sickLeave: 10,
          maternityLeave: 0
        },
        loans: {
          personalLoan: { principal: 0, interest: 0, emi: 0 },
          vehicleLoan: { principal: 500000, interest: 50000, emi: 25000 },
          educationLoan: { principal: 0, interest: 0, emi: 0 },
          totalOutstanding: 550000
        },
        reimbursements: {
          medical: 5000,
          travel: 12000,
          internet: 1000,
          books: 0,
          total: 18000
        },
        yearToDate: {
          grossSalary: 4500000,
          taxPaid: 420000,
          pfContribution: 360000,
          esiContribution: 54000,
          netSalary: 3420000
        }
      },
      {
        id: 'E0002',
        name: 'Michael Chen',
        department: 'Technology',
        designation: 'Chief Technology Officer',
        email: 'michael.chen@company.com',
        phone: '+1 (555) 222-2222',
        joinDate: '2020-03-20',
        dob: '1980-12-05',
        panNumber: 'FGHIJ5678K',
        uanNumber: '100987654321',
        bankDetails: {
          accountNumber: 'XXXX-XXXX-4567',
          bankName: 'Tech Bank',
          ifscCode: 'TECH0005678',
          branch: 'San Francisco'
        },
        salaryStructure: {
          basic: 180000,
          hra: 90000,
          da: 36000,
          specialAllowance: 54000,
          medicalAllowance: 15000,
          conveyance: 8000,
          otherAllowances: 12000,
          bonus: 40000,
          overtime: 24000
        },
        deductions: {
          pfEmployee: 21600,
          pfEmployer: 21600,
          esiEmployee: 1620,
          esiEmployer: 3240,
          professionalTax: 2000,
          tds: 25000,
          loanEmi: 15000,
          otherDeductions: 0
        },
        attendance: {
          present: 21,
          casualLeave: 3,
          sickLeave: 0,
          paidLeave: 0,
          holidays: 4,
          weeklyOff: 8,
          overtimeHours: 12
        },
        leaveBalance: {
          earnedLeave: 15,
          casualLeave: 6,
          sickLeave: 8,
          maternityLeave: 0
        },
        loans: {
          personalLoan: { principal: 300000, interest: 30000, emi: 15000 },
          vehicleLoan: { principal: 0, interest: 0, emi: 0 },
          educationLoan: { principal: 0, interest: 0, emi: 0 },
          totalOutstanding: 330000
        },
        reimbursements: {
          medical: 3000,
          travel: 8000,
          internet: 1000,
          books: 2000,
          total: 14000
        },
        yearToDate: {
          grossSalary: 3240000,
          taxPaid: 300000,
          pfContribution: 259200,
          esiContribution: 38880,
          netSalary: 2560320
        }
      },
      {
        id: 'E0003',
        name: 'Lisa Wang',
        department: 'Finance',
        designation: 'Finance Manager',
        email: 'lisa.wang@company.com',
        phone: '+1 (555) 333-3333',
        joinDate: '2021-06-10',
        dob: '1988-07-15',
        panNumber: 'KLMNO9012P',
        uanNumber: '100456789123',
        bankDetails: {
          accountNumber: 'XXXX-XXXX-2345',
          bankName: 'Financial Bank',
          ifscCode: 'FINB0004567',
          branch: 'Chicago'
        },
        salaryStructure: {
          basic: 120000,
          hra: 60000,
          da: 24000,
          specialAllowance: 36000,
          medicalAllowance: 12500,
          conveyance: 8000,
          otherAllowances: 7500,
          bonus: 30000,
          overtime: 12000
        },
        deductions: {
          pfEmployee: 14400,
          pfEmployer: 14400,
          esiEmployee: 1080,
          esiEmployer: 2160,
          professionalTax: 2000,
          tds: 18000,
          loanEmi: 8000,
          otherDeductions: 0
        },
        attendance: {
          present: 23,
          casualLeave: 1,
          sickLeave: 0,
          paidLeave: 0,
          holidays: 4,
          weeklyOff: 8,
          overtimeHours: 6
        },
        leaveBalance: {
          earnedLeave: 18,
          casualLeave: 9,
          sickLeave: 12,
          maternityLeave: 0
        },
        reimbursements: {
          medical: 2500,
          travel: 6000,
          internet: 1000,
          books: 1500,
          total: 11000
        },
        yearToDate: {
          grossSalary: 2160000,
          taxPaid: 216000,
          pfContribution: 172800,
          esiContribution: 25920,
          netSalary: 1745280
        }
      },
      {
        id: 'E0004',
        name: 'David Kumar',
        department: 'Sales',
        designation: 'Sales Director',
        email: 'david.kumar@company.com',
        phone: '+1 (555) 444-4444',
        joinDate: '2022-01-15',
        dob: '1990-09-20',
        panNumber: 'PQRST3456U',
        uanNumber: '100789123456',
        bankDetails: {
          accountNumber: 'XXXX-XXXX-6789',
          bankName: 'Sales Bank',
          ifscCode: 'SALE0007890',
          branch: 'Miami'
        },
        salaryStructure: {
          basic: 150000,
          hra: 75000,
          da: 30000,
          specialAllowance: 45000,
          medicalAllowance: 12500,
          conveyance: 8000,
          otherAllowances: 14500,
          bonus: 50000,
          overtime: 18000
        },
        deductions: {
          pfEmployee: 18000,
          pfEmployer: 18000,
          esiEmployee: 1350,
          esiEmployer: 2700,
          professionalTax: 2000,
          tds: 28000,
          loanEmi: 12000,
          otherDeductions: 0
        },
        attendance: {
          present: 20,
          casualLeave: 4,
          sickLeave: 0,
          paidLeave: 0,
          holidays: 4,
          weeklyOff: 8,
          overtimeHours: 15
        },
        leaveBalance: {
          earnedLeave: 10,
          casualLeave: 5,
          sickLeave: 7,
          maternityLeave: 0
        },
        reimbursements: {
          medical: 3500,
          travel: 15000,
          internet: 1000,
          books: 0,
          total: 19500
        },
        yearToDate: {
          grossSalary: 2700000,
          taxPaid: 252000,
          pfContribution: 216000,
          esiContribution: 32400,
          netSalary: 2203200
        }
      }
    ],

    salarySlips: [
      {
        id: 'SS202403001',
        employeeId: 'E0001',
        employeeName: 'Sarah Johnson',
        month: 'March 2024',
        period: '2024-03-01 to 2024-03-31',
        dateGenerated: '2024-03-05',
        grossSalary: 530000,
        netSalary: 412500,
        status: 'distributed',
        distributionMethod: 'email',
        password: 'SJ03011985',
        downloaded: true,
        emailSent: true,
        emailDate: '2024-03-05',
        smsSent: true,
        smsDate: '2024-03-05'
      },
      {
        id: 'SS202402001',
        employeeId: 'E0001',
        employeeName: 'Sarah Johnson',
        month: 'February 2024',
        period: '2024-02-01 to 2024-02-29',
        dateGenerated: '2024-02-05',
        grossSalary: 530000,
        netSalary: 412500,
        status: 'distributed',
        distributionMethod: 'portal',
        password: 'SJ03011985',
        downloaded: true,
        emailSent: true,
        emailDate: '2024-02-05',
        smsSent: true,
        smsDate: '2024-02-05'
      },
      {
        id: 'SS202403002',
        employeeId: 'E0002',
        employeeName: 'Michael Chen',
        month: 'March 2024',
        period: '2024-03-01 to 2024-03-31',
        dateGenerated: '2024-03-05',
        grossSalary: 395000,
        netSalary: 320000,
        status: 'distributed',
        distributionMethod: 'portal',
        password: 'MC05121980',
        downloaded: true,
        emailSent: true,
        emailDate: '2024-03-05',
        smsSent: true,
        smsDate: '2024-03-05'
      },
      {
        id: 'SS202403003',
        employeeId: 'E0003',
        employeeName: 'Lisa Wang',
        month: 'March 2024',
        period: '2024-03-01 to 2024-03-31',
        dateGenerated: '2024-03-05',
        grossSalary: 287000,
        netSalary: 233000,
        status: 'generated',
        distributionMethod: 'none',
        password: 'LW15071988',
        downloaded: false,
        emailSent: false,
        emailDate: '',
        smsSent: false,
        smsDate: ''
      },
      {
        id: 'SS202403004',
        employeeId: 'E0004',
        employeeName: 'David Kumar',
        month: 'March 2024',
        period: '2024-03-01 to 2024-03-31',
        dateGenerated: '2024-03-05',
        grossSalary: 345000,
        netSalary: 275000,
        status: 'distributed',
        distributionMethod: 'email',
        password: 'DK20091990',
        downloaded: true,
        emailSent: true,
        emailDate: '2024-03-05',
        smsSent: true,
        smsDate: '2024-03-05'
      }
    ]
  });

  // Initialize
  useEffect(() => {
    if (salaryData.employees.length > 0 && !selectedEmployee) {
      setSelectedEmployee(salaryData.employees[0]);
    }
    setEmailTemplate(companySettings.emailBody);
    setTimeout(() => {
      setIsLoading(false);
    }, 1000);
  }, []);

  // Helper functions
  const formatCurrency = (amount) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(amount);
  };

  const formatDate = (dateString) => {
    if (!dateString) return '';
    return new Date(dateString).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };

  const numberToWords = (num) => {
    const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
    const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
    const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];

    if (num === 0) return 'Zero';
    
    const convertLessThanThousand = (n) => {
      if (n === 0) return '';
      
      let word = '';
      
      if (Math.floor(n / 100) > 0) {
        word += ones[Math.floor(n / 100)] + ' Hundred ';
        n %= 100;
      }
      
      if (n >= 10 && n <= 19) {
        word += teens[n - 10] + ' ';
      } else {
        if (Math.floor(n / 10) > 1) {
          word += tens[Math.floor(n / 10)] + ' ';
          n %= 10;
        }
        if (n > 0) {
          word += ones[n] + ' ';
        }
      }
      
      return word.trim();
    };

    let word = '';
    const crore = Math.floor(num / 10000000);
    const lakh = Math.floor((num % 10000000) / 100000);
    const thousand = Math.floor((num % 100000) / 1000);
    const remainder = num % 1000;

    if (crore > 0) {
      word += convertLessThanThousand(crore) + ' Crore ';
    }
    if (lakh > 0) {
      word += convertLessThanThousand(lakh) + ' Lakh ';
    }
    if (thousand > 0) {
      word += convertLessThanThousand(thousand) + ' Thousand ';
    }
    if (remainder > 0) {
      word += convertLessThanThousand(remainder);
    }

    return word.trim() + ' Rupees Only';
  };

  const calculateTotals = (employee) => {
    const earnings = Object.values(employee.salaryStructure).reduce((a, b) => a + b, 0);
    const deductions = Object.values(employee.deductions).reduce((a, b) => a + b, 0);
    const grossSalary = earnings;
    const netSalary = grossSalary - deductions;
    
    return {
      earnings,
      deductions,
      grossSalary,
      netSalary,
      words: numberToWords(netSalary)
    };
  };

  const generatePassword = (employee) => {
    if (companySettings.defaultPassword === 'dob') {
      return employee.dob.replace(/-/g, '');
    } else if (companySettings.defaultPassword === 'custom') {
      return employee.id + employee.dob?.replace(/-/g, '') || employee.id + '0101';
    } else {
      return employee.id;
    }
  };

  const handleGenerateSalarySlip = async () => {
    if (!selectedEmployee) {
      alert('Please select an employee');
      return;
    }

    setGenerationStatus('generating');
    
    try {
      const totals = calculateTotals(selectedEmployee);
      const month = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
      const slipId = `SS${new Date().getFullYear()}${String(new Date().getMonth() + 1).padStart(2, '0')}${String(salaryData.salarySlips.length + 1).padStart(3, '0')}`;
      const password = generatePassword(selectedEmployee);
      
      const newSlip = {
        id: slipId,
        employeeId: selectedEmployee.id,
        employeeName: selectedEmployee.name,
        month: month,
        period: `${selectedMonth}-01 to ${selectedMonth}-${new Date(new Date(selectedMonth + '-01').getFullYear(), new Date(selectedMonth + '-01').getMonth() + 1, 0).getDate()}`,
        dateGenerated: new Date().toISOString().split('T')[0],
        grossSalary: totals.grossSalary,
        netSalary: totals.netSalary,
        status: 'generated',
        distributionMethod: 'none',
        password: password,
        downloaded: false,
        emailSent: false,
        emailDate: '',
        smsSent: false,
        smsDate: ''
      };

      setSalaryData(prev => ({
        ...prev,
        salarySlips: [newSlip, ...prev.salarySlips]
      }));

      if (notificationSettings.autoSend) {
        setTimeout(() => {
          handleDistributeSalarySlip(newSlip.id);
        }, 1000);
      }

      setGenerationStatus('completed');
      
      // Show success message
      const successMsg = `Salary slip generated successfully for ${selectedEmployee.name}!`;
      if (notificationSettings.autoSend) {
        successMsg += ' Distribution initiated...';
      }
      alert(successMsg);
      
    } catch (error) {
      console.error('Error generating salary slip:', error);
      alert('Error generating salary slip. Please try again.');
      setGenerationStatus('error');
    }
  };

  const handleDistributeSalarySlip = async (slipId) => {
    setGenerationStatus('distributing');
    
    const slip = salaryData.salarySlips.find(s => s.id === slipId);
    if (!slip) return;

    const employee = salaryData.employees.find(e => e.id === slip.employeeId);
    if (!employee) return;

    const updatedSlip = {
      ...slip,
      status: 'distributed',
      distributionMethod: distributionMethod,
      emailSent: notificationSettings.email,
      emailDate: notificationSettings.email ? new Date().toISOString().split('T')[0] : '',
      smsSent: notificationSettings.sms,
      smsDate: notificationSettings.sms ? new Date().toISOString().split('T')[0] : ''
    };

    setSalaryData(prev => ({
      ...prev,
      salarySlips: prev.salarySlips.map(s => s.id === slipId ? updatedSlip : s)
    }));

    // Simulate email sending
    if (notificationSettings.email) {
      setTimeout(() => {
        const emailBody = emailTemplate
          .replace('[Employee Name]', employee.name)
          .replace('[Month Year]', slip.month)
          .replace('[Net Amount]', formatCurrency(slip.netSalary))
          .replace('[Payment Date]', formatDate(slip.dateGenerated))
          .replace('[Password]', slip.password);

        console.log('Email sent to:', employee.email);
        console.log('Subject:', companySettings.emailSubject.replace('[Month Year]', slip.month));
        console.log('Body:', emailBody);
      }, 1000);
    }

    // Simulate SMS sending
    if (notificationSettings.sms) {
      setTimeout(() => {
        console.log('SMS sent to:', employee.phone);
        console.log('Message:', `Your salary slip for ${slip.month} is available. Net: ${formatCurrency(slip.netSalary)}`);
      }, 1500);
    }

    setTimeout(() => {
      setGenerationStatus('completed');
      alert(`Salary slip distributed successfully via ${distributionMethod}!`);
    }, 2000);
  };

  const handleDownloadPDF = async (employee, slipId = null) => {
    if (!employee) return;
    
    setGenerationStatus('downloading');
    
    try {
      const totals = calculateTotals(employee);
      const slip = slipId 
        ? salaryData.salarySlips.find(s => s.id === slipId)
        : salaryData.salarySlips.find(s => s.employeeId === employee.id && s.month === new Date().toLocaleString('default', { month: 'long', year: 'numeric' }));

      // Create printable HTML
      const printWindow = window.open('', '_blank');
      const month = slip?.month || new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
      const period = slip?.period || `${selectedMonth}-01 to ${selectedMonth}-${new Date(new Date(selectedMonth + '-01').getFullYear(), new Date(selectedMonth + '-01').getMonth() + 1, 0).getDate()}`;
      const password = slip?.password || generatePassword(employee);
      
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Salary Slip - ${employee.name}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 40px; }
            .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; }
            .company-name { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
            .company-address { font-size: 12px; color: #666; margin-bottom: 10px; }
            .salary-slip-title { font-size: 18px; font-weight: bold; color: #2c3e50; margin: 15px 0; }
            .employee-info { margin-bottom: 20px; }
            .section { margin-bottom: 30px; }
            .section-title { background: #f8f9fa; padding: 8px; border-left: 4px solid #3498db; font-weight: bold; margin-bottom: 10px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
            th { background: #f8f9fa; text-align: left; padding: 8px; border-bottom: 1px solid #ddd; }
            td { padding: 8px; border-bottom: 1px solid #eee; }
            .total-row { font-weight: bold; background: #e8f4fc; }
            .text-right { text-align: right; }
            .text-center { text-align: center; }
            .footer { margin-top: 50px; border-top: 1px solid #ddd; padding-top: 20px; font-size: 10px; color: #666; }
            .signature { margin-top: 40px; text-align: right; }
            .signature-line { border-top: 1px solid #000; width: 200px; display: inline-block; }
            .password { background: #f8f9fa; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; }
            @media print {
              body { margin: 20px; }
              .no-print { display: none; }
              @page { margin: 20mm; }
            }
          </style>
        </head>
        <body>
          <div class="header">
            <div class="company-name">${companySettings.name}</div>
            <div class="company-address">${companySettings.address}</div>
            <div class="salary-slip-title">SALARY SLIP</div>
            <div>For the month of: ${month}</div>
            <div>Period: ${period}</div>
            <div>Payment Date: ${formatDate(new Date())}</div>
          </div>
          
          <div class="employee-info">
            <table>
              <tr>
                <td style="width: 50%;">
                  <strong>Employee Name:</strong> ${employee.name}<br>
                  <strong>Employee ID:</strong> ${employee.id}<br>
                  <strong>Designation:</strong> ${employee.designation}<br>
                  <strong>Department:</strong> ${employee.department}
                </td>
                <td style="width: 50%;">
                  <strong>Bank Name:</strong> ${employee.bankDetails.bankName}<br>
                  <strong>Account No:</strong> ${employee.bankDetails.accountNumber}<br>
                  <strong>IFSC Code:</strong> ${employee.bankDetails.ifscCode}<br>
                  <strong>PAN Number:</strong> ${employee.panNumber}
                </td>
              </tr>
            </table>
          </div>
          
          <div class="section">
            <div class="section-title">EARNINGS</div>
            <table>
              ${Object.entries(employee.salaryStructure).map(([key, value]) => `
                <tr>
                  <td>${key.replace(/([A-Z])/g, ' $1').toUpperCase()}</td>
                  <td class="text-right">${formatCurrency(value)}</td>
                </tr>
              `).join('')}
              <tr class="total-row">
                <td>TOTAL EARNINGS</td>
                <td class="text-right">${formatCurrency(totals.earnings)}</td>
              </tr>
            </table>
          </div>
          
          <div class="section">
            <div class="section-title">DEDUCTIONS</div>
            <table>
              ${Object.entries(employee.deductions).map(([key, value]) => `
                <tr>
                  <td>${key.toUpperCase().replace('PFEMPLOYEE', 'PF EMPLOYEE').replace('PFEMPLOYER', 'PF EMPLOYER').replace('ESIEMPLOYEE', 'ESI EMPLOYEE').replace('ESIEMPLOYER', 'ESI EMPLOYER').replace('TDS', 'INCOME TAX')}</td>
                  <td class="text-right">${formatCurrency(value)}</td>
                </tr>
              `).join('')}
              <tr class="total-row">
                <td>TOTAL DEDUCTIONS</td>
                <td class="text-right">${formatCurrency(totals.deductions)}</td>
              </tr>
            </table>
          </div>
          
          <div class="section">
            <table>
              <tr class="total-row">
                <td><strong>GROSS SALARY</strong></td>
                <td class="text-right">${formatCurrency(totals.grossSalary)}</td>
              </tr>
              <tr class="total-row">
                <td><strong>TOTAL DEDUCTIONS</strong></td>
                <td class="text-right">${formatCurrency(totals.deductions)}</td>
              </tr>
              <tr style="background: #d4edda;">
                <td><strong>NET SALARY PAYABLE</strong></td>
                <td class="text-right"><strong>${formatCurrency(totals.netSalary)}</strong></td>
              </tr>
              <tr>
                <td colspan="2">
                  <strong>In Words:</strong> ${totals.words}
                </td>
              </tr>
            </table>
          </div>
          
          <div class="section">
            <div class="section-title">ATTENDANCE SUMMARY</div>
            <table>
              <tr>
                <td>Present Days</td>
                <td>${employee.attendance.present}</td>
                <td>Casual Leave</td>
                <td>${employee.attendance.casualLeave}</td>
              </tr>
              <tr>
                <td>Sick Leave</td>
                <td>${employee.attendance.sickLeave}</td>
                <td>Overtime Hours</td>
                <td>${employee.attendance.overtimeHours}</td>
              </tr>
              <tr>
                <td>Weekly Off</td>
                <td>${employee.attendance.weeklyOff}</td>
                <td>Holidays</td>
                <td>${employee.attendance.holidays}</td>
              </tr>
            </table>
          </div>
          
          ${slip && passwordProtect ? `
            <div class="section">
              <div class="section-title">SECURITY INFORMATION</div>
              <div class="password">
                <strong>PDF Password:</strong> ${password}<br>
                <small>Use this password to open the PDF file</small>
              </div>
            </div>
          ` : ''}
          
          <div class="signature">
            <div style="margin-bottom: 60px;">
              <div class="signature-line"></div><br>
              <strong>${companySettings.signatory}</strong><br>
              Authorized Signatory
            </div>
          </div>
          
          <div class="footer text-center">
            <div>${companySettings.confidentiality}</div>
            <div>${companySettings.footerText}</div>
            <div>Generated on: ${new Date().toLocaleString()}</div>
          </div>
          
          <div class="no-print" style="margin-top: 20px; text-align: center;">
            <button onclick="window.print()" style="padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px;">Print Salary Slip</button>
            <button onclick="window.close()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; cursor: pointer; margin: 5px;">Close</button>
          </div>
          
          <script>
            window.onload = function() {
              window.print();
            };
          </script>
        </body>
        </html>
      `;
      
      printWindow.document.write(htmlContent);
      printWindow.document.close();
      
      // Update slip status if it exists
      if (slip) {
        setSalaryData(prev => ({
          ...prev,
          salarySlips: prev.salarySlips.map(s =>
            s.id === slip.id ? { ...s, downloaded: true } : s
          )
        }));
      }
      
      setGenerationStatus('completed');
      
    } catch (error) {
      console.error('Error downloading PDF:', error);
      alert('Error downloading PDF. Please try again.');
      setGenerationStatus('error');
    }
  };

  const handleSendEmail = async (employee, slipId = null) => {
    if (!employee) return;
    
    setGenerationStatus('sending');
    
    try {
      const slip = slipId 
        ? salaryData.salarySlips.find(s => s.id === slipId)
        : salaryData.salarySlips.find(s => s.employeeId === employee.id && s.month === new Date().toLocaleString('default', { month: 'long', year: 'numeric' }));

      if (!slip) {
        alert('No salary slip found for this employee.');
        setGenerationStatus('error');
        return;
      }

      // Simulate email sending
      setTimeout(() => {
        const emailBody = emailTemplate
          .replace('[Employee Name]', employee.name)
          .replace('[Month Year]', slip.month)
          .replace('[Net Amount]', formatCurrency(slip.netSalary))
          .replace('[Payment Date]', formatDate(slip.dateGenerated))
          .replace('[Password]', slip.password);

        // Update slip status
        setSalaryData(prev => ({
          ...prev,
          salarySlips: prev.salarySlips.map(s =>
            s.id === slip.id ? { 
              ...s, 
              emailSent: true,
              emailDate: new Date().toISOString().split('T')[0],
              status: 'distributed',
              distributionMethod: 'email'
            } : s
          )
        }));

        setGenerationStatus('completed');
        alert(`Salary slip sent via email to ${employee.email}`);
        
        // Log email details
        console.log('Email details:', {
          to: employee.email,
          subject: companySettings.emailSubject.replace('[Month Year]', slip.month),
          body: emailBody,
          cc: notificationSettings.ccHR ? 'hr@company.com' : null,
          bcc: notificationSettings.bccAccounts ? 'accounts@company.com' : null
        });
        
      }, 2000);
      
    } catch (error) {
      console.error('Error sending email:', error);
      alert('Error sending email. Please try again.');
      setGenerationStatus('error');
    }
  };

  const handleSendSMS = (employee, slipId = null) => {
    if (!employee) return;
    
    const slip = slipId 
      ? salaryData.salarySlips.find(s => s.id === slipId)
      : salaryData.salarySlips.find(s => s.employeeId === employee.id && s.month === new Date().toLocaleString('default', { month: 'long', year: 'numeric' }));

    if (!slip) {
      alert('No salary slip found for this employee.');
      return;
    }

    // Update slip status
    setSalaryData(prev => ({
      ...prev,
      salarySlips: prev.salarySlips.map(s =>
        s.id === slip.id ? { 
          ...s, 
          smsSent: true,
          smsDate: new Date().toISOString().split('T')[0]
        } : s
      )
    }));

    // Simulate SMS sending
    const smsMessage = `Dear ${employee.name}, your salary slip for ${slip.month} is available. Net: ${formatCurrency(slip.netSalary)}. Password: ${slip.password}`;
    
    console.log('SMS sent:', {
      to: employee.phone,
      message: smsMessage
    });

    alert(`SMS notification sent to ${employee.phone}`);
  };

  const handleBulkDownload = async () => {
    if (selectedSlips.length === 0 && bulkOptions.month === 'all') {
      alert('Please select slips to download or choose a specific month');
      return;
    }

    setGenerationStatus('processing');
    
    try {
      const slipsToDownload = bulkOptions.month === 'all' 
        ? selectedSlips.map(id => salaryData.salarySlips.find(s => s.id === id)).filter(Boolean)
        : salaryData.salarySlips.filter(slip => {
            const slipMonth = slip.month.toLowerCase();
            const selectedMonthName = new Date(bulkOptions.month + '-01').toLocaleString('default', { month: 'long', year: 'numeric' }).toLowerCase();
            return slipMonth.includes(selectedMonthName);
          });

      if (slipsToDownload.length === 0) {
        alert('No salary slips found for the selected criteria');
        setGenerationStatus('idle');
        return;
      }

      if (bulkOptions.format === 'excel') {
        await handleExportToExcel(slipsToDownload);
      } else if (bulkOptions.format === 'zip') {
        // Simulate ZIP download
        setTimeout(() => {
          const blob = new Blob(['Simulated ZIP file'], { type: 'application/zip' });
          saveAs(blob, `salary_slips_${new Date().toISOString().split('T')[0]}.zip`);
          
          // Update all slips as downloaded
          setSalaryData(prev => ({
            ...prev,
            salarySlips: prev.salarySlips.map(slip => 
              slipsToDownload.some(s => s.id === slip.id) ? { ...slip, downloaded: true } : slip
            )
          }));
          
          setGenerationStatus('completed');
          alert(`Bulk download completed. ${slipsToDownload.length} files processed.`);
        }, 3000);
      } else {
        // Individual PDFs - open print window for each
        slipsToDownload.forEach((slip, index) => {
          setTimeout(() => {
            const employee = salaryData.employees.find(e => e.id === slip.employeeId);
            if (employee) {
              const printWindow = window.open('', '_blank');
              // Similar HTML content as in handleDownloadPDF but without print trigger
              printWindow.document.write('<h1>Salary Slip PDF would be generated here</h1>');
              printWindow.document.close();
              
              // Update slip status
              setSalaryData(prev => ({
                ...prev,
                salarySlips: prev.salarySlips.map(s =>
                  s.id === slip.id ? { ...s, downloaded: true } : s
                )
              }));
            }
          }, index * 1000);
        });
        
        setTimeout(() => {
          setGenerationStatus('completed');
          alert(`Opening ${slipsToDownload.length} salary slips in new windows for printing.`);
        }, slipsToDownload.length * 1000);
      }

      setShowBulkDialog(false);
      
    } catch (error) {
      console.error('Error in bulk download:', error);
      alert('Error processing bulk download. Please try again.');
      setGenerationStatus('error');
    }
  };

  const handleExportToExcel = (slips) => {
    const data = slips.map(slip => {
      const employee = salaryData.employees.find(e => e.id === slip.employeeId);
      return {
        'Slip ID': slip.id,
        'Employee ID': slip.employeeId,
        'Employee Name': slip.employeeName,
        'Month': slip.month,
        'Period': slip.period,
        'Gross Salary': slip.grossSalary,
        'Net Salary': slip.netSalary,
        'Status': slip.status,
        'Distribution Method': slip.distributionMethod,
        'Password': bulkOptions.includePassword ? slip.password : '***',
        'Date Generated': slip.dateGenerated,
        'Email Sent': slip.emailSent ? 'Yes' : 'No',
        'SMS Sent': slip.smsSent ? 'Yes' : 'No',
        'Department': employee?.department || '',
        'Designation': employee?.designation || ''
      };
    });

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Salary Slips');
    
    // Add summary sheet
    const summaryData = [{
      'Total Slips': slips.length,
      'Total Gross Salary': slips.reduce((sum, slip) => sum + slip.grossSalary, 0),
      'Total Net Salary': slips.reduce((sum, slip) => sum + slip.netSalary, 0),
      'Distributed': slips.filter(s => s.status === 'distributed').length,
      'Generated': slips.filter(s => s.status === 'generated').length
    }];
    
    const ws2 = XLSX.utils.json_to_sheet(summaryData);
    XLSX.utils.book_append_sheet(wb, ws2, 'Summary');

    XLSX.writeFile(wb, `salary_slips_export_${new Date().toISOString().split('T')[0]}.xlsx`);
    
    setGenerationStatus('completed');
    alert(`Excel export completed. ${slips.length} records exported.`);
  };

  const handleGenerateAll = async () => {
    setGenerationStatus('processing');
    
    try {
      const month = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
      const period = `${selectedMonth}-01 to ${selectedMonth}-${new Date(new Date(selectedMonth + '-01').getFullYear(), new Date(selectedMonth + '-01').getMonth() + 1, 0).getDate()}`;
      
      const newSlips = salaryData.employees.map((employee, index) => {
        const totals = calculateTotals(employee);
        return {
          id: `SS${new Date().getFullYear()}${String(new Date().getMonth() + 1).padStart(2, '0')}${String(salaryData.salarySlips.length + index + 1).padStart(3, '0')}`,
          employeeId: employee.id,
          employeeName: employee.name,
          month: month,
          period: period,
          dateGenerated: new Date().toISOString().split('T')[0],
          grossSalary: totals.grossSalary,
          netSalary: totals.netSalary,
          status: 'generated',
          distributionMethod: 'none',
          password: generatePassword(employee),
          downloaded: false,
          emailSent: false,
          emailDate: '',
          smsSent: false,
          smsDate: ''
        };
      });

      setSalaryData(prev => ({
        ...prev,
        salarySlips: [...newSlips, ...prev.salarySlips]
      }));

      if (notificationSettings.autoSend) {
        setTimeout(() => {
          newSlips.forEach(slip => {
            handleDistributeSalarySlip(slip.id);
          });
        }, 1000);
      }

      setGenerationStatus('completed');
      alert(`Salary slips generated for ${newSlips.length} employees.`);
      
    } catch (error) {
      console.error('Error generating all salary slips:', error);
      alert('Error generating salary slips. Please try again.');
      setGenerationStatus('error');
    }
  };

  const toggleSelectSlip = (slipId) => {
    setSelectedSlips(prev =>
      prev.includes(slipId)
        ? prev.filter(id => id !== slipId)
        : [...prev, slipId]
    );
  };

  const selectAllSlips = () => {
    if (selectedSlips.length === salaryData.salarySlips.length) {
      setSelectedSlips([]);
    } else {
      setSelectedSlips(salaryData.salarySlips.map(slip => slip.id));
    }
  };

  const handleUpdateCompanySettings = () => {
    // Validate required fields
    if (!companySettings.name.trim()) {
      alert('Company name is required');
      return;
    }
    
    if (!companySettings.address.trim()) {
      alert('Company address is required');
      return;
    }
    
    if (!companySettings.signatory.trim()) {
      alert('Authorized signatory is required');
      return;
    }

    // Save settings (in real app, this would be an API call)
    localStorage.setItem('salarySlipSettings', JSON.stringify(companySettings));
    localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
    
    // Update email template
    setEmailTemplate(companySettings.emailBody);
    
    setShowSettingsDialog(false);
    alert('Settings saved successfully!');
  };

  const handleResetSettings = () => {
    if (window.confirm('Are you sure you want to reset all settings to default?')) {
      const defaultSettings = {
        name: 'TechCorp Global Solutions',
        address: '123 Tech Park, Silicon Valley, CA 94000',
        logo: 'https://api.dicebear.com/7.x/shapes/svg?seed=TechCorp',
        signatory: 'Lisa Wilson - HR Director',
        seal: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Seal',
        footerText: 'Generated by HRMS Salary Slip System v2.0',
        confidentiality: 'This document is confidential and intended only for the employee. Unauthorized distribution is prohibited.',
        autoEmail: true,
        smsNotification: true,
        defaultPassword: 'employee_id',
        emailSubject: 'Your Salary Slip for [Month Year]',
        emailBody: `Dear [Employee Name],

Your salary slip for [Month Year] has been generated.

Net Salary: [Net Amount]
Payment Date: [Payment Date]

You can download your salary slip from the employee portal or it is attached to this email.

Password: [Password]

Best regards,
HR Department`,
        retentionPeriod: 12,
        allowRevisions: true,
        revisionDays: 7
      };
      
      setCompanySettings(defaultSettings);
      setEmailTemplate(defaultSettings.emailBody);
      
      const defaultNotifications = {
        email: true,
        sms: true,
        portal: true,
        autoSend: true,
        sendTime: '09:00',
        ccHR: true,
        bccAccounts: false
      };
      
      setNotificationSettings(defaultNotifications);
      alert('Settings reset to default values.');
    }
  };

  const handleExportSettings = () => {
    const settingsData = {
      companySettings,
      notificationSettings,
      exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(settingsData, null, 2)], { type: 'application/json' });
    saveAs(blob, `salary_slip_settings_${new Date().toISOString().split('T')[0]}.json`);
  };

  const handleImportSettings = (event) => {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const importedSettings = JSON.parse(e.target.result);
        
        if (importedSettings.companySettings) {
          setCompanySettings(importedSettings.companySettings);
          setEmailTemplate(importedSettings.companySettings.emailBody);
        }
        
        if (importedSettings.notificationSettings) {
          setNotificationSettings(importedSettings.notificationSettings);
        }
        
        alert('Settings imported successfully!');
      } catch (error) {
        alert('Error importing settings. Please check the file format.');
      }
    };
    reader.readAsText(file);
  };

  const handleDeleteSlip = (slipId) => {
    if (window.confirm('Are you sure you want to delete this salary slip? This action cannot be undone.')) {
      setSalaryData(prev => ({
        ...prev,
        salarySlips: prev.salarySlips.filter(slip => slip.id !== slipId)
      }));
      
      // Remove from selected slips if present
      setSelectedSlips(prev => prev.filter(id => id !== slipId));
      
      alert('Salary slip deleted successfully.');
    }
  };

  const handleSendReminder = (employee, slipId) => {
    const slip = salaryData.salarySlips.find(s => s.id === slipId);
    if (!slip || !employee) return;
    
    // Simulate reminder email
    const reminderBody = `Dear ${employee.name},

This is a reminder that your salary slip for ${slip.month} is available for download.

Net Salary: ${formatCurrency(slip.netSalary)}
Password: ${slip.password}

Please download it from the employee portal.

Best regards,
HR Department`;

    console.log('Reminder sent to:', employee.email);
    console.log('Reminder body:', reminderBody);
    
    alert(`Reminder sent to ${employee.email}`);
  };

  const handleResendEmail = (employee, slipId) => {
    const slip = salaryData.salarySlips.find(s => s.id === slipId);
    if (!slip || !employee) return;
    
    // Update slip with new email date
    setSalaryData(prev => ({
      ...prev,
      salarySlips: prev.salarySlips.map(s =>
        s.id === slipId ? { 
          ...s, 
          emailSent: true,
          emailDate: new Date().toISOString().split('T')[0]
        } : s
      )
    }));
    
    // Simulate email resend
    const emailBody = emailTemplate
      .replace('[Employee Name]', employee.name)
      .replace('[Month Year]', slip.month)
      .replace('[Net Amount]', formatCurrency(slip.netSalary))
      .replace('[Payment Date]', formatDate(slip.dateGenerated))
      .replace('[Password]', slip.password);
    
    console.log('Email resent to:', employee.email);
    console.log('Email body:', emailBody);
    
    alert(`Email resent to ${employee.email}`);
  };

  // Filter slips based on search term
  const filteredSlips = salaryData.salarySlips.filter(slip => 
    slip.employeeName.toLowerCase().includes(searchTerm.toLowerCase()) ||
    slip.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
    slip.month.toLowerCase().includes(searchTerm.toLowerCase()) ||
    slip.employeeId.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // Calculate statistics
  const stats = {
    totalSlips: salaryData.salarySlips.length,
    totalEmployees: salaryData.employees.length,
    distributedSlips: salaryData.salarySlips.filter(s => s.status === 'distributed').length,
    totalPayout: salaryData.salarySlips.reduce((sum, slip) => sum + slip.netSalary, 0),
    pendingDistribution: salaryData.salarySlips.filter(s => s.status === 'generated').length,
    emailSent: salaryData.salarySlips.filter(s => s.emailSent).length,
    smsSent: salaryData.salarySlips.filter(s => s.smsSent).length
  };

  // Render Salary Slip Preview
  const renderSalarySlipPreview = () => {
    if (!selectedEmployee) return null;
    
    const totals = calculateTotals(selectedEmployee);
    const currentMonth = new Date().toLocaleString('default', { month: 'long', year: 'numeric' });
    const slip = salaryData.salarySlips.find(s => s.employeeId === selectedEmployee.id && s.month === currentMonth);
    
    return (
      <div ref={slipPreviewRef} style={{
        backgroundColor: 'white',
        borderRadius: '10px',
        padding: '20px',
        marginBottom: '20px',
        boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
      }}>
        <div style={{ textAlign: 'center', marginBottom: '30px', borderBottom: '2px solid #e0e0e0', paddingBottom: '20px' }}>
          <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '20px', marginBottom: '10px' }}>
            <img src={companySettings.logo} alt="Company Logo" style={{ width: '60px', height: '60px' }} />
            <div>
              <h3 style={{ margin: 0, color: '#2c3e50' }}>{companySettings.name}</h3>
              <p style={{ margin: '5px 0 0 0', color: '#7f8c8d', fontSize: '14px' }}>{companySettings.address}</p>
            </div>
            <img src={companySettings.seal} alt="Company Seal" style={{ width: '60px', height: '60px' }} />
          </div>
          <h2 style={{ margin: '20px 0 10px 0', color: '#3498db' }}>SALARY SLIP</h2>
          <p style={{ margin: 0, color: '#7f8c8d' }}>For the month of: {currentMonth}</p>
          <p style={{ margin: '5px 0 0 0', color: '#7f8c8d', fontSize: '14px' }}>
            Period: {slip?.period || `${selectedMonth}-01 to ${selectedMonth}-${new Date(new Date(selectedMonth + '-01').getFullYear(), new Date(selectedMonth + '-01').getMonth() + 1, 0).getDate()}`}
          </p>
        </div>
        
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '30px', marginBottom: '30px' }}>
          <div>
            <h4 style={{ margin: '0 0 10px 0', color: '#2c3e50' }}>Employee Details</h4>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <tbody>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>Employee Name:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.name}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>Employee ID:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.id}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>Designation:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.designation}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>Department:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.department}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>PAN Number:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.panNumber}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div>
            <h4 style={{ margin: '0 0 10px 0', color: '#2c3e50' }}>Bank Details</h4>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <tbody>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>Bank Name:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.bankDetails.bankName}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>Account Number:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.bankDetails.accountNumber}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>IFSC Code:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.bankDetails.ifscCode}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>UAN Number:</td>
                  <td style={{ padding: '8px 0' }}>{selectedEmployee.uanNumber}</td>
                </tr>
                <tr>
                  <td style={{ padding: '8px 0', fontWeight: '600' }}>Payment Date:</td>
                  <td style={{ padding: '8px 0' }}>{new Date().toISOString().split('T')[0]}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '30px', marginBottom: '30px' }}>
          <div>
            <div style={{ backgroundColor: '#f8f9fa', padding: '10px', borderLeft: '4px solid #3498db', marginBottom: '15px' }}>
              <h4 style={{ margin: 0, color: '#2c3e50' }}>EARNINGS</h4>
            </div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <tbody>
                {Object.entries(selectedEmployee.salaryStructure).map(([key, value]) => (
                  <tr key={key}>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{key.replace(/([A-Z])/g, ' $1').toUpperCase()}</td>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', textAlign: 'right', fontWeight: '600' }}>{formatCurrency(value)}</td>
                  </tr>
                ))}
                <tr style={{ backgroundColor: '#e8f4fc' }}>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', fontWeight: 'bold' }}>TOTAL EARNINGS</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', textAlign: 'right', fontWeight: 'bold' }}>{formatCurrency(totals.earnings)}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div>
            <div style={{ backgroundColor: '#f8f9fa', padding: '10px', borderLeft: '4px solid #e74c3c', marginBottom: '15px' }}>
              <h4 style={{ margin: 0, color: '#2c3e50' }}>DEDUCTIONS</h4>
            </div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <tbody>
                {Object.entries(selectedEmployee.deductions).map(([key, value]) => (
                  <tr key={key}>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{key.toUpperCase().replace('PFEMPLOYEE', 'PF EMPLOYEE').replace('PFEMPLOYER', 'PF EMPLOYER').replace('ESIEMPLOYEE', 'ESI EMPLOYEE').replace('ESIEMPLOYER', 'ESI EMPLOYER').replace('TDS', 'INCOME TAX')}</td>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', textAlign: 'right', fontWeight: '600', color: '#e74c3c' }}>-{formatCurrency(value)}</td>
                  </tr>
                ))}
                <tr style={{ backgroundColor: '#f8d7da' }}>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', fontWeight: 'bold' }}>TOTAL DEDUCTIONS</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', textAlign: 'right', fontWeight: 'bold', color: '#e74c3c' }}>-{formatCurrency(totals.deductions)}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div style={{ backgroundColor: '#f8f9fa', padding: '20px', borderRadius: '8px', marginBottom: '30px' }}>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Summary</h4>
              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <tbody>
                  <tr>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Gross Salary:</td>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', textAlign: 'right', fontWeight: '600', color: '#27ae60' }}>{formatCurrency(totals.grossSalary)}</td>
                  </tr>
                  <tr>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Total Deductions:</td>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', textAlign: 'right', fontWeight: '600', color: '#e74c3c' }}>-{formatCurrency(totals.deductions)}</td>
                  </tr>
                  <tr style={{ borderTop: '2px solid #e0e0e0' }}>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', fontWeight: 'bold', fontSize: '16px' }}>Net Salary:</td>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0', textAlign: 'right', fontWeight: 'bold', fontSize: '18px', color: '#3498db' }}>{formatCurrency(totals.netSalary)}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            
            <div>
              <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>In Words</h4>
              <div style={{ padding: '15px', backgroundColor: 'white', borderRadius: '6px', border: '1px solid #e0e0e0' }}>
                <p style={{ margin: 0, fontStyle: 'italic', color: '#7f8c8d' }}>{totals.words}</p>
              </div>
            </div>
          </div>
        </div>
        
        {slip && passwordProtect && (
          <div style={{ backgroundColor: '#fff3cd', padding: '15px', borderRadius: '6px', marginBottom: '20px', border: '1px solid #ffeaa7' }}>
            <h4 style={{ margin: '0 0 10px 0', color: '#856404' }}>Security Information</h4>
            <p style={{ margin: 0, color: '#856404' }}>
              <strong>PDF Password:</strong> {slip.password}
              <br />
              <small>Use this password to open the PDF file</small>
            </p>
          </div>
        )}
        
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '30px', marginBottom: '30px' }}>
          <div>
            <div style={{ backgroundColor: '#f8f9fa', padding: '10px', borderLeft: '4px solid #2ecc71', marginBottom: '15px' }}>
              <h4 style={{ margin: 0, color: '#2c3e50' }}>ATTENDANCE SUMMARY</h4>
            </div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <tbody>
                <tr>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Present Days</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{selectedEmployee.attendance.present}</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Overtime Hours</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{selectedEmployee.attendance.overtimeHours}</td>
                </tr>
                <tr>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Casual Leave</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{selectedEmployee.attendance.casualLeave}</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Sick Leave</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{selectedEmployee.attendance.sickLeave}</td>
                </tr>
                <tr>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Weekly Off</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{selectedEmployee.attendance.weeklyOff}</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>Holidays</td>
                  <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{selectedEmployee.attendance.holidays}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div>
            <div style={{ backgroundColor: '#f8f9fa', padding: '10px', borderLeft: '4px solid #9b59b6', marginBottom: '15px' }}>
              <h4 style={{ margin: 0, color: '#2c3e50' }}>LEAVE BALANCE</h4>
            </div>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <tbody>
                {Object.entries(selectedEmployee.leaveBalance).map(([key, value]) => (
                  <tr key={key}>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{key.replace(/([A-Z])/g, ' $1').toUpperCase()}</td>
                    <td style={{ padding: '12px', borderBottom: '1px solid #e0e0e0' }}>{value} days</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
        
        <div style={{ marginTop: '40px', borderTop: '1px solid #e0e0e0', paddingTop: '20px' }}>
          <div style={{ float: 'right', textAlign: 'center' }}>
            <div style={{ borderTop: '1px solid #000', width: '200px', marginBottom: '5px' }}></div>
            <p style={{ margin: 0, fontWeight: '600' }}>{companySettings.signatory}</p>
            <p style={{ margin: 0, color: '#7f8c8d' }}>Authorized Signatory</p>
          </div>
          <div style={{ clear: 'both' }}></div>
        </div>
        
        <div style={{ marginTop: '40px', paddingTop: '20px', borderTop: '1px solid #e0e0e0', fontSize: '12px', color: '#7f8c8d', textAlign: 'center' }}>
          <p style={{ margin: '5px 0' }}>{companySettings.confidentiality}</p>
          <p style={{ margin: '5px 0' }}>{companySettings.footerText}</p>
          <p style={{ margin: '5px 0' }}>Generated on: {new Date().toLocaleString()}</p>
        </div>
        
        <div style={{ marginTop: '30px', display: 'flex', gap: '10px', justifyContent: 'center' }}>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: 'none',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              display: 'flex',
              alignItems: 'center',
              gap: '8px',
              transition: 'all 0.3s ease',
              backgroundColor: '#3498db',
              color: 'white'
            }}
            onClick={() => window.print()}
          >
            <Icon icon="heroicons:printer" />
            Print Preview
          </button>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: '2px solid #3498db',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              display: 'flex',
              alignItems: 'center',
              gap: '8px',
              transition: 'all 0.3s ease',
              backgroundColor: 'transparent',
              color: '#3498db'
            }}
            onClick={() => setShowPreview(false)}
          >
            <Icon icon="heroicons:x-mark" />
            Close Preview
          </button>
        </div>
      </div>
    );
  };

  // Render Generate Tab
  const renderGenerateTab = () => (
    <div style={{
      backgroundColor: 'white',
      borderRadius: '10px',
      padding: '20px',
      marginBottom: '20px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
    }}>
      <div style={{
        fontSize: '18px',
        fontWeight: 'bold',
        color: '#2c3e50',
        marginBottom: '20px',
        display: 'flex',
        alignItems: 'center',
        gap: '10px'
      }}>
        <Icon icon="heroicons:document-plus" />
        Generate Salary Slips
      </div>
      
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px', marginBottom: '20px' }}>
        <div style={{ marginBottom: '15px' }}>
          <label style={{
            display: 'block',
            marginBottom: '8px',
            fontWeight: '600',
            color: '#2c3e50'
          }}>Select Employee</label>
          <select 
            style={{
              padding: '10px',
              borderRadius: '6px',
              border: '1px solid #ddd',
              fontSize: '14px',
              width: '100%',
              boxSizing: 'border-box',
              backgroundColor: 'white'
            }}
            value={selectedEmployee?.id || ''}
            onChange={(e) => {
              const emp = salaryData.employees.find(emp => emp.id === e.target.value);
              setSelectedEmployee(emp);
            }}
          >
            <option value="">Select an employee</option>
            {salaryData.employees.map(emp => (
              <option key={emp.id} value={emp.id}>{emp.name} ({emp.department})</option>
            ))}
          </select>
        </div>
        
        <div style={{ marginBottom: '15px' }}>
          <label style={{
            display: 'block',
            marginBottom: '8px',
            fontWeight: '600',
            color: '#2c3e50'
          }}>Pay Period</label>
          <select 
            style={{
              padding: '10px',
              borderRadius: '6px',
              border: '1px solid #ddd',
              fontSize: '14px',
              width: '100%',
              boxSizing: 'border-box',
              backgroundColor: 'white'
            }}
            value={selectedMonth}
            onChange={(e) => setSelectedMonth(e.target.value)}
          >
            <option value="2024-03">March 2024</option>
            <option value="2024-02">February 2024</option>
            <option value="2024-01">January 2024</option>
            <option value="2023-12">December 2023</option>
          </select>
        </div>
      </div>
      
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px', marginBottom: '20px' }}>
        <div style={{ marginBottom: '15px' }}>
          <label style={{
            display: 'block',
            marginBottom: '8px',
            fontWeight: '600',
            color: '#2c3e50'
          }}>Distribution Method</label>
          <select 
            style={{
              padding: '10px',
              borderRadius: '6px',
              border: '1px solid #ddd',
              fontSize: '14px',
              width: '100%',
              boxSizing: 'border-box',
              backgroundColor: 'white'
            }}
            value={distributionMethod}
            onChange={(e) => setDistributionMethod(e.target.value)}
          >
            <option value="email">Email to Employee</option>
            <option value="portal">Employee Portal</option>
            <option value="both">Both Email & Portal</option>
            <option value="print">Print Only</option>
          </select>
        </div>
        
        <div style={{ marginBottom: '15px' }}>
          <label style={{
            display: 'block',
            marginBottom: '8px',
            fontWeight: '600',
            color: '#2c3e50'
          }}>Password Protection</label>
          <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
            <input
              type="checkbox"
              checked={passwordProtect}
              onChange={(e) => setPasswordProtect(e.target.checked)}
              style={{ marginRight: '10px' }}
            />
            <span>Protect PDF with employee's DOB</span>
          </div>
        </div>
      </div>
      
      {selectedEmployee && (
        <div style={{
          backgroundColor: '#f8f9fa',
          padding: '15px',
          borderRadius: '8px',
          marginBottom: '20px'
        }}>
          <div style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            marginBottom: '10px'
          }}>
            <h4 style={{ margin: 0, color: '#2c3e50' }}>Selected Employee</h4>
            <span style={{
              padding: '5px 10px',
              backgroundColor: '#3498db',
              color: 'white',
              borderRadius: '4px',
              fontSize: '12px',
              fontWeight: '600'
            }}>
              {selectedEmployee.department}
            </span>
          </div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '10px' }}>
            <div>
              <strong>Name:</strong> {selectedEmployee.name}
            </div>
            <div>
              <strong>Designation:</strong> {selectedEmployee.designation}
            </div>
            <div>
              <strong>Email:</strong> {selectedEmployee.email}
            </div>
            <div>
              <strong>Phone:</strong> {selectedEmployee.phone}
            </div>
          </div>
        </div>
      )}
      
      <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: 'none',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: '#3498db',
            color: 'white'
          }}
          onClick={handleGenerateSalarySlip}
          disabled={generationStatus === 'generating' || generationStatus === 'processing'}
        >
          {generationStatus === 'generating' ? (
            <>
              <Icon icon="heroicons:arrow-path" className="animate-spin" />
              Generating...
            </>
          ) : (
            <>
              <Icon icon="heroicons:document-plus" />
              Generate Salary Slip
            </>
          )}
        </button>
        
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: 'none',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: '#2ecc71',
            color: 'white'
          }}
          onClick={handleGenerateAll}
          disabled={generationStatus === 'processing' || generationStatus === 'generating'}
        >
          <Icon icon="heroicons:users" />
          Generate All
        </button>
        
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: 'none',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: '#f39c12',
            color: 'white'
          }}
          onClick={() => setShowPreview(!showPreview)}
        >
          <Icon icon="heroicons:eye" />
          {showPreview ? 'Hide Preview' : 'Show Preview'}
        </button>
      </div>
      
      {showPreview && (
        <div style={{ marginTop: '30px' }}>
          {renderSalarySlipPreview()}
        </div>
      )}
    </div>
  );

  // Render History Tab
  const renderHistoryTab = () => (
    <div style={{
      backgroundColor: 'white',
      borderRadius: '10px',
      padding: '20px',
      marginBottom: '20px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
    }}>
      <div style={{
        fontSize: '18px',
        fontWeight: 'bold',
        color: '#2c3e50',
        marginBottom: '20px',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between'
      }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
          <Icon icon="heroicons:clock" />
          Salary Slip History
        </div>
        <div style={{ display: 'flex', gap: '10px' }}>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: '2px solid #3498db',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              display: 'flex',
              alignItems: 'center',
              gap: '8px',
              transition: 'all 0.3s ease',
              backgroundColor: 'transparent',
              color: '#3498db'
            }}
            onClick={() => setShowBulkDialog(true)}
            disabled={generationStatus === 'processing'}
          >
            <Icon icon="heroicons:arrow-down-tray" />
            Bulk Download
          </button>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: 'none',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              display: 'flex',
              alignItems: 'center',
              gap: '8px',
              transition: 'all 0.3s ease',
              backgroundColor: '#3498db',
              color: 'white'
            }}
            onClick={() => {
              setSearchTerm('');
              setSelectedSlips([]);
            }}
          >
            <Icon icon="heroicons:refresh" />
            Refresh
          </button>
        </div>
      </div>
      
      <div style={{ marginBottom: '20px' }}>
        <div style={{ position: 'relative' }}>
          <input
            type="text"
            style={{
              padding: '10px 10px 10px 40px',
              borderRadius: '6px',
              border: '1px solid #ddd',
              fontSize: '14px',
              width: '100%',
              boxSizing: 'border-box'
            }}
            placeholder="Search by employee name, ID, month, or status..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
          <Icon 
            icon="heroicons:magnifying-glass" 
            style={{
              position: 'absolute',
              left: '12px',
              top: '50%',
              transform: 'translateY(-50%)',
              color: '#7f8c8d'
            }}
          />
        </div>
      </div>
      
      <div style={{ overflowX: 'auto' }}>
        <table style={{ width: '100%', borderCollapse: 'collapse', minWidth: '1000px' }}>
          <thead>
            <tr>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>
                <input
                  type="checkbox"
                  checked={selectedSlips.length === filteredSlips.length && filteredSlips.length > 0}
                  onChange={selectAllSlips}
                  style={{ marginRight: '10px' }}
                />
                Select
              </th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Slip ID</th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Employee</th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Month</th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Amount</th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Status</th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Distribution</th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Date Generated</th>
              <th style={{
                backgroundColor: '#f8f9fa',
                padding: '12px',
                textAlign: 'left',
                borderBottom: '2px solid #e0e0e0',
                fontWeight: 'bold',
                color: '#2c3e50',
                whiteSpace: 'nowrap'
              }}>Actions</th>
            </tr>
          </thead>
          <tbody>
            {filteredSlips.map(slip => {
              const employee = salaryData.employees.find(e => e.id === slip.employeeId);
              return (
                <tr key={slip.id} style={{ borderBottom: '1px solid #e0e0e0' }}>
                  <td style={{ padding: '12px' }}>
                    <input
                      type="checkbox"
                      checked={selectedSlips.includes(slip.id)}
                      onChange={() => toggleSelectSlip(slip.id)}
                      style={{ marginRight: '10px' }}
                    />
                  </td>
                  <td style={{ padding: '12px' }}>{slip.id}</td>
                  <td style={{ padding: '12px' }}>
                    <div>
                      <div style={{ fontWeight: '600' }}>{slip.employeeName}</div>
                      <div style={{ fontSize: '12px', color: '#7f8c8d' }}>ID: {slip.employeeId}  {employee?.department}</div>
                    </div>
                  </td>
                  <td style={{ padding: '12px' }}>{slip.month}</td>
                  <td style={{ padding: '12px' }}>
                    <div style={{ fontWeight: '600' }}>{formatCurrency(slip.netSalary)}</div>
                    <div style={{ fontSize: '12px', color: '#7f8c8d' }}>Gross: {formatCurrency(slip.grossSalary)}</div>
                  </td>
                  <td style={{ padding: '12px' }}>
                    <span style={{
                      padding: '5px 10px',
                      borderRadius: '20px',
                      fontSize: '12px',
                      fontWeight: '600',
                      backgroundColor: slip.status === 'distributed' ? '#d4edda' : 
                                       slip.status === 'generated' ? '#fff3cd' : '#f8d7da',
                      color: slip.status === 'distributed' ? '#155724' : 
                             slip.status === 'generated' ? '#856404' : '#721c24',
                      display: 'inline-block'
                    }}>
                      {slip.status.toUpperCase()}
                    </span>
                  </td>
                  <td style={{ padding: '12px' }}>
                    <div>
                      <div style={{ fontSize: '12px', color: '#7f8c8d' }}>{slip.distributionMethod}</div>
                      <div style={{ fontSize: '11px', color: '#95a5a6' }}>
                        {slip.emailSent && <span> </span>}
                        {slip.smsSent && <span> </span>}
                        {slip.downloaded && <span> </span>}
                      </div>
                    </div>
                  </td>
                  <td style={{ padding: '12px' }}>{slip.dateGenerated}</td>
                  <td style={{ padding: '12px' }}>
                    <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                      <button
                        style={{
                          width: '32px',
                          height: '32px',
                          borderRadius: '6px',
                          border: 'none',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '14px',
                          backgroundColor: '#3498db',
                          color: 'white'
                        }}
                        onClick={() => handleDownloadPDF(employee, slip.id)}
                        title="Download PDF"
                        disabled={generationStatus === 'downloading'}
                      >
                        <Icon icon="heroicons:arrow-down-tray" />
                      </button>
                      <button
                        style={{
                          width: '32px',
                          height: '32px',
                          borderRadius: '6px',
                          border: 'none',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '14px',
                          backgroundColor: '#2ecc71',
                          color: 'white'
                        }}
                        onClick={() => handleSendEmail(employee, slip.id)}
                        title="Send via Email"
                        disabled={generationStatus === 'sending'}
                      >
                        <Icon icon="heroicons:envelope" />
                      </button>
                      <button
                        style={{
                          width: '32px',
                          height: '32px',
                          borderRadius: '6px',
                          border: 'none',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '14px',
                          backgroundColor: '#f39c12',
                          color: 'white'
                        }}
                        onClick={() => {
                          const emp = salaryData.employees.find(e => e.id === slip.employeeId);
                          setSelectedEmployee(emp);
                          setShowPreview(true);
                        }}
                        title="Preview"
                      >
                        <Icon icon="heroicons:eye" />
                      </button>
                      <button
                        style={{
                          width: '32px',
                          height: '32px',
                          borderRadius: '6px',
                          border: 'none',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '14px',
                          backgroundColor: '#9b59b6',
                          color: 'white'
                        }}
                        onClick={() => handleSendReminder(employee, slip.id)}
                        title="Send Reminder"
                      >
                        <Icon icon="heroicons:bell-alert" />
                      </button>
                      <button
                        style={{
                          width: '32px',
                          height: '32px',
                          borderRadius: '6px',
                          border: 'none',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '14px',
                          backgroundColor: '#e74c3c',
                          color: 'white'
                        }}
                        onClick={() => handleDeleteSlip(slip.id)}
                        title="Delete"
                      >
                        <Icon icon="heroicons:trash" />
                      </button>
                    </div>
                  </td>
                </tr>
              );
            })}
          </tbody>
        </table>
        
        {filteredSlips.length === 0 && (
          <div style={{ textAlign: 'center', padding: '40px', color: '#7f8c8d' }}>
            <Icon icon="heroicons:document-text" style={{ fontSize: '48px', marginBottom: '20px' }} />
            <h3 style={{ margin: '0 0 10px 0', color: '#2c3e50' }}>No salary slips found</h3>
            <p>Try adjusting your search or generate new salary slips.</p>
          </div>
        )}
      </div>
      
      <div style={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginTop: '20px',
        paddingTop: '20px',
        borderTop: '1px solid #e0e0e0'
      }}>
        <div style={{ color: '#7f8c8d', fontSize: '14px' }}>
          Showing {filteredSlips.length} of {salaryData.salarySlips.length} salary slips
        </div>
        <div style={{ display: 'flex', gap: '10px' }}>
          <button
            style={{
              padding: '8px 16px',
              borderRadius: '6px',
              border: '1px solid #ddd',
              cursor: 'pointer',
              fontSize: '14px',
              backgroundColor: 'white',
              color: '#2c3e50'
            }}
            onClick={() => handleExportToExcel(selectedSlips.length > 0 ? selectedSlips.map(id => filteredSlips.find(s => s.id === id)).filter(Boolean) : filteredSlips)}
          >
            <Icon icon="heroicons:document-arrow-down" style={{ marginRight: '5px' }} />
            Export to Excel
          </button>
          <button
            style={{
              padding: '8px 16px',
              borderRadius: '6px',
              border: '1px solid #ddd',
              cursor: 'pointer',
              fontSize: '14px',
              backgroundColor: 'white',
              color: '#2c3e50'
            }}
            onClick={() => {
              const slipsToDelete = selectedSlips;
              if (slipsToDelete.length === 0) {
                alert('Please select slips to delete');
                return;
              }
              if (window.confirm(`Are you sure you want to delete ${slipsToDelete.length} salary slip(s)?`)) {
                setSalaryData(prev => ({
                  ...prev,
                  salarySlips: prev.salarySlips.filter(slip => !slipsToDelete.includes(slip.id))
                }));
                setSelectedSlips([]);
                alert(`${slipsToDelete.length} salary slip(s) deleted successfully.`);
              }
            }}
          >
            <Icon icon="heroicons:trash" style={{ marginRight: '5px' }} />
            Delete Selected
          </button>
        </div>
      </div>
    </div>
  );

  // Render Distribution Tab
  const renderDistributionTab = () => (
    <div style={{
      backgroundColor: 'white',
      borderRadius: '10px',
      padding: '20px',
      marginBottom: '20px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
    }}>
      <div style={{
        fontSize: '18px',
        fontWeight: 'bold',
        color: '#2c3e50',
        marginBottom: '20px',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between'
      }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
          <Icon icon="heroicons:paper-airplane" />
          Distribution Settings
        </div>
        <button
          style={{
            padding: '8px 16px',
            borderRadius: '6px',
            border: '2px solid #3498db',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: 'transparent',
            color: '#3498db'
          }}
          onClick={handleResetSettings}
        >
          <Icon icon="heroicons:arrow-path" />
          Reset to Default
        </button>
      </div>
      
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '30px', marginBottom: '30px' }}>
        <div>
          <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Email Settings</h4>
          <div style={{ marginBottom: '15px' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
              <input 
                type="checkbox" 
                checked={notificationSettings.email}
                onChange={(e) => setNotificationSettings(prev => ({...prev, email: e.target.checked}))}
                style={{ marginRight: '10px' }} 
              />
              <span>Send automatic email on generation</span>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
              <input 
                type="checkbox" 
                checked={notificationSettings.ccHR}
                onChange={(e) => setNotificationSettings(prev => ({...prev, ccHR: e.target.checked}))}
                style={{ marginRight: '10px' }} 
              />
              <span>CC HR Department</span>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
              <input 
                type="checkbox" 
                checked={notificationSettings.bccAccounts}
                onChange={(e) => setNotificationSettings(prev => ({...prev, bccAccounts: e.target.checked}))}
                style={{ marginRight: '10px' }} 
              />
              <span>BCC Accounts Department</span>
            </div>
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Email Subject</label>
            <input
              type="text"
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                backgroundColor: 'white'
              }}
              value={companySettings.emailSubject}
              onChange={(e) => setCompanySettings(prev => ({...prev, emailSubject: e.target.value}))}
            />
          </div>
        </div>
        
        <div>
          <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Portal & SMS Settings</h4>
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Default Password</label>
            <select 
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                backgroundColor: 'white'
              }} 
              value={companySettings.defaultPassword}
              onChange={(e) => setCompanySettings(prev => ({...prev, defaultPassword: e.target.value}))}
            >
              <option value="employee_id">Employee ID</option>
              <option value="dob">Date of Birth (DDMMYYYY)</option>
              <option value="custom">Custom Password</option>
            </select>
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
              <input 
                type="checkbox" 
                checked={notificationSettings.sms}
                onChange={(e) => setNotificationSettings(prev => ({...prev, sms: e.target.checked}))}
                style={{ marginRight: '10px' }} 
              />
              <span>Send SMS notification</span>
            </div>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
              <input 
                type="checkbox" 
                checked={notificationSettings.portal}
                onChange={(e) => setNotificationSettings(prev => ({...prev, portal: e.target.checked}))}
                style={{ marginRight: '10px' }} 
              />
              <span>Enable employee portal access</span>
            </div>
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Auto-send Time</label>
            <input
              type="time"
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                backgroundColor: 'white'
              }}
              value={notificationSettings.sendTime}
              onChange={(e) => setNotificationSettings(prev => ({...prev, sendTime: e.target.value}))}
            />
          </div>
        </div>
      </div>
      
      <div style={{ marginBottom: '30px' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
          <h4 style={{ margin: 0, color: '#2c3e50' }}>Email Template</h4>
          <button
            style={{
              padding: '5px 10px',
              borderRadius: '4px',
              border: '1px solid #ddd',
              cursor: 'pointer',
              fontSize: '12px',
              backgroundColor: 'white',
              color: '#2c3e50'
            }}
            onClick={() => setEmailTemplate(companySettings.emailBody)}
          >
            Reset Template
          </button>
        </div>
        <textarea
          style={{
            padding: '15px',
            borderRadius: '6px',
            border: '1px solid #ddd',
            fontSize: '14px',
            width: '100%',
            boxSizing: 'border-box',
            minHeight: '200px',
            fontFamily: 'monospace',
            lineHeight: '1.5'
          }}
          value={emailTemplate}
          onChange={(e) => setEmailTemplate(e.target.value)}
        />
        <div style={{ marginTop: '10px', fontSize: '12px', color: '#7f8c8d' }}>
          <strong>Available placeholders:</strong> [Employee Name], [Month Year], [Net Amount], [Payment Date], [Password]
        </div>
      </div>
      
      <div style={{ display: 'flex', gap: '10px' }}>
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: 'none',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: '#3498db',
            color: 'white'
          }}
          onClick={handleUpdateCompanySettings}
        >
          <Icon icon="heroicons:check" />
          Save Settings
        </button>
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: '2px solid #3498db',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: 'transparent',
            color: '#3498db'
          }}
          onClick={() => setShowSettingsDialog(true)}
        >
          <Icon icon="heroicons:cog" />
          Advanced Settings
        </button>
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: '2px solid #2ecc71',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: 'transparent',
            color: '#2ecc71'
          }}
          onClick={handleExportSettings}
        >
          <Icon icon="heroicons:arrow-up-tray" />
          Export Settings
        </button>
        <label
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: '2px solid #9b59b6',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: 'transparent',
            color: '#9b59b6'
          }}
        >
          <Icon icon="heroicons:arrow-down-tray" />
          Import Settings
          <input
            type="file"
            accept=".json"
            onChange={handleImportSettings}
            style={{ display: 'none' }}
          />
        </label>
      </div>
    </div>
  );

  // Render Settings Tab
  const renderSettingsTab = () => (
    <div style={{
      backgroundColor: 'white',
      borderRadius: '10px',
      padding: '20px',
      marginBottom: '20px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
    }}>
      <div style={{
        fontSize: '18px',
        fontWeight: 'bold',
        color: '#2c3e50',
        marginBottom: '20px',
        display: 'flex',
        alignItems: 'center',
        gap: '10px'
      }}>
        <Icon icon="heroicons:cog-6-tooth" />
        System Settings
      </div>
      
      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '30px', marginBottom: '30px' }}>
        <div>
          <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Company Information</h4>
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Company Name</label>
            <input
              type="text"
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                backgroundColor: 'white'
              }}
              value={companySettings.name}
              onChange={(e) => setCompanySettings(prev => ({...prev, name: e.target.value}))}
            />
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Company Address</label>
            <textarea
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                minHeight: '80px',
                resize: 'vertical'
              }}
              value={companySettings.address}
              onChange={(e) => setCompanySettings(prev => ({...prev, address: e.target.value}))}
            />
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Authorized Signatory</label>
            <input
              type="text"
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                backgroundColor: 'white'
              }}
              value={companySettings.signatory}
              onChange={(e) => setCompanySettings(prev => ({...prev, signatory: e.target.value}))}
            />
          </div>
        </div>
        
        <div>
          <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Document Settings</h4>
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Footer Text</label>
            <input
              type="text"
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                backgroundColor: 'white'
              }}
              value={companySettings.footerText}
              onChange={(e) => setCompanySettings(prev => ({...prev, footerText: e.target.value}))}
            />
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Confidentiality Text</label>
            <textarea
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                minHeight: '80px',
                resize: 'vertical'
              }}
              value={companySettings.confidentiality}
              onChange={(e) => setCompanySettings(prev => ({...prev, confidentiality: e.target.value}))}
            />
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <label style={{
              display: 'block',
              marginBottom: '8px',
              fontWeight: '600',
              color: '#2c3e50'
            }}>Retention Period (months)</label>
            <input
              type="number"
              min="1"
              max="60"
              style={{
                padding: '10px',
                borderRadius: '6px',
                border: '1px solid #ddd',
                fontSize: '14px',
                width: '100%',
                boxSizing: 'border-box',
                backgroundColor: 'white'
              }}
              value={companySettings.retentionPeriod}
              onChange={(e) => setCompanySettings(prev => ({...prev, retentionPeriod: parseInt(e.target.value)}))}
            />
          </div>
        </div>
      </div>
      
      <div style={{ borderTop: '1px solid #e0e0e0', paddingTop: '20px', marginTop: '20px' }}>
        <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Advanced Settings</h4>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '20px' }}>
          <div style={{ marginBottom: '15px' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
              <input 
                type="checkbox" 
                checked={companySettings.allowRevisions}
                onChange={(e) => setCompanySettings(prev => ({...prev, allowRevisions: e.target.checked}))}
                style={{ marginRight: '10px' }} 
              />
              <span>Allow salary slip revisions</span>
            </div>
            {companySettings.allowRevisions && (
              <div style={{ marginLeft: '30px', marginTop: '5px' }}>
                <label style={{ fontSize: '14px', color: '#7f8c8d' }}>
                  Revision allowed for: 
                  <input
                    type="number"
                    min="1"
                    max="30"
                    style={{
                      padding: '5px',
                      borderRadius: '4px',
                      border: '1px solid #ddd',
                      fontSize: '14px',
                      width: '60px',
                      marginLeft: '10px'
                    }}
                    value={companySettings.revisionDays}
                    onChange={(e) => setCompanySettings(prev => ({...prev, revisionDays: parseInt(e.target.value)}))}
                  />
                  days
                </label>
              </div>
            )}
          </div>
          
          <div style={{ marginBottom: '15px' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '10px' }}>
              <input 
                type="checkbox" 
                checked={notificationSettings.autoSend}
                onChange={(e) => setNotificationSettings(prev => ({...prev, autoSend: e.target.checked}))}
                style={{ marginRight: '10px' }} 
              />
              <span>Auto-send on generation</span>
            </div>
          </div>
        </div>
      </div>
      
      <div style={{ display: 'flex', gap: '10px', marginTop: '30px' }}>
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: 'none',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: '#3498db',
            color: 'white'
          }}
          onClick={handleUpdateCompanySettings}
        >
          <Icon icon="heroicons:check" />
          Save All Settings
        </button>
        <button
          style={{
            padding: '10px 20px',
            borderRadius: '6px',
            border: '2px solid #e74c3c',
            cursor: 'pointer',
            fontSize: '14px',
            fontWeight: '600',
            display: 'flex',
            alignItems: 'center',
            gap: '8px',
            transition: 'all 0.3s ease',
            backgroundColor: 'transparent',
            color: '#e74c3c'
          }}
          onClick={handleResetSettings}
        >
          <Icon icon="heroicons:arrow-path" />
          Reset to Default
        </button>
      </div>
    </div>
  );

  // Loading state
  if (isLoading) {
    return (
      <RecruiterDashboardLayout>
        <div style={{ 
          display: 'flex', 
          justifyContent: 'center', 
          alignItems: 'center', 
          minHeight: '100vh',
          backgroundColor: '#f5f5f5'
        }}>
          <div style={{ textAlign: 'center' }}>
            <div style={{ 
              width: '50px', 
              height: '50px', 
              border: '5px solid #f3f3f3',
              borderTop: '5px solid #3498db',
              borderRadius: '50%',
              animation: 'spin 1s linear infinite',
              margin: '0 auto 20px'
            }}></div>
            <p style={{ color: '#7f8c8d', fontSize: '18px' }}>Loading Salary Slip System...</p>
          </div>
        </div>
      </RecruiterDashboardLayout>
    );
  }

  return (
    <div>
      {/* Main content area */}
      <div style={{
        padding: '20px',
        backgroundColor: '#f5f5f5',
        minHeight: '100vh',
        width: '100%',
        position: 'relative',
        left: '0',
        marginLeft: '0'
      }}>
        {/* Header */}
        <div style={{
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          marginBottom: '30px',
          paddingBottom: '20px',
          borderBottom: '2px solid #e0e0e0'
        }}>
          <div>
            <h5 style={{
              fontSize: '28px',
              fontWeight: 'bold',
              color: '#2c3e50',
              margin: 0
            }}>Salary Slip Generation & Distribution</h5>
            <p style={{
              fontSize: '16px',
              color: '#7f8c8d',
              marginTop: '5px'
            }}>Generate, distribute, and manage employee salary slips</p>
          </div>
          <div style={{ display: 'flex', gap: '10px' }}>
            <button
              style={{
                padding: '10px 20px',
                borderRadius: '6px',
                border: 'none',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: '600',
                display: 'flex',
                alignItems: 'center',
                gap: '8px',
                transition: 'all 0.3s ease',
                backgroundColor: '#3498db',
                color: 'white'
              }}
              onClick={() => handleGenerateAll()}
              disabled={generationStatus === 'processing' || generationStatus === 'generating'}
            >
              <Icon icon="heroicons:document-plus" />
              Generate All
            </button>
            <button
              style={{
                padding: '10px 20px',
                borderRadius: '6px',
                border: '2px solid #3498db',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: '600',
                display: 'flex',
                alignItems: 'center',
                gap: '8px',
                transition: 'all 0.3s ease',
                backgroundColor: 'transparent',
                color: '#3498db'
              }}
              onClick={() => window.print()}
            >
              <Icon icon="heroicons:printer" />
              Print Reports
            </button>
          </div>
        </div>

        {/* Stats */}
        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(4, 1fr)',
          gap: '20px',
          marginBottom: '30px'
        }}>
          <div style={{
            backgroundColor: 'white',
            borderRadius: '10px',
            padding: '20px',
            textAlign: 'center',
            boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
          }}>
            <Icon icon="heroicons:document-text" style={{ fontSize: '24px', color: '#3498db' }} />
            <div style={{
              fontSize: '28px',
              fontWeight: 'bold',
              color: '#2c3e50',
              margin: '10px 0'
            }}>{stats.totalSlips}</div>
            <div style={{
              fontSize: '14px',
              color: '#7f8c8d'
            }}>Total Slips Generated</div>
          </div>
          
          <div style={{
            backgroundColor: 'white',
            borderRadius: '10px',
            padding: '20px',
            textAlign: 'center',
            boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
          }}>
            <Icon icon="heroicons:users" style={{ fontSize: '24px', color: '#2ecc71' }} />
            <div style={{
              fontSize: '28px',
              fontWeight: 'bold',
              color: '#2c3e50',
              margin: '10px 0'
            }}>{stats.totalEmployees}</div>
            <div style={{
              fontSize: '14px',
              color: '#7f8c8d'
            }}>Active Employees</div>
          </div>
          
          <div style={{
            backgroundColor: 'white',
            borderRadius: '10px',
            padding: '20px',
            textAlign: 'center',
            boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
          }}>
            <Icon icon="heroicons:envelope" style={{ fontSize: '24px', color: '#9b59b6' }} />
            <div style={{
              fontSize: '28px',
              fontWeight: 'bold',
              color: '#2c3e50',
              margin: '10px 0'
            }}>
              {stats.distributedSlips}
            </div>
            <div style={{
              fontSize: '14px',
              color: '#7f8c8d'
            }}>Distributed Slips</div>
          </div>
          
          <div style={{
            backgroundColor: 'white',
            borderRadius: '10px',
            padding: '20px',
            textAlign: 'center',
            boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
          }}>
            <Icon icon="heroicons:currency-rupee" style={{ fontSize: '24px', color: '#f39c12' }} />
            <div style={{
              fontSize: '28px',
              fontWeight: 'bold',
              color: '#2c3e50',
              margin: '10px 0'
            }}>
              {formatCurrency(stats.totalPayout)}
            </div>
            <div style={{
              fontSize: '14px',
              color: '#7f8c8d'
            }}>Total Payout</div>
          </div>
        </div>

        {/* Tabs */}
        <div style={{
          display: 'flex',
          gap: '10px',
          marginBottom: '20px',
          borderBottom: '1px solid #e0e0e0',
          paddingBottom: '10px'
        }}>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: 'none',
              backgroundColor: activeTab === 'generate' ? '#3498db' : 'transparent',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              color: activeTab === 'generate' ? 'white' : '#7f8c8d',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}
            onClick={() => setActiveTab('generate')}
          >
            <Icon icon="heroicons:document-plus" />
            Generate
          </button>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: 'none',
              backgroundColor: activeTab === 'history' ? '#3498db' : 'transparent',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              color: activeTab === 'history' ? 'white' : '#7f8c8d',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}
            onClick={() => setActiveTab('history')}
          >
            <Icon icon="heroicons:clock" />
            History
          </button>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: 'none',
              backgroundColor: activeTab === 'distribution' ? '#3498db' : 'transparent',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              color: activeTab === 'distribution' ? 'white' : '#7f8c8d',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}
            onClick={() => setActiveTab('distribution')}
          >
            <Icon icon="heroicons:paper-airplane" />
            Distribution
          </button>
          <button
            style={{
              padding: '10px 20px',
              borderRadius: '6px',
              border: 'none',
              backgroundColor: activeTab === 'settings' ? '#3498db' : 'transparent',
              cursor: 'pointer',
              fontSize: '14px',
              fontWeight: '600',
              color: activeTab === 'settings' ? 'white' : '#7f8c8d',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}
            onClick={() => setActiveTab('settings')}
          >
            <Icon icon="heroicons:cog-6-tooth" />
            Settings
          </button>
        </div>

        {/* Tab Content */}
        {activeTab === 'generate' && renderGenerateTab()}
        {activeTab === 'history' && renderHistoryTab()}
        {activeTab === 'distribution' && renderDistributionTab()}
        {activeTab === 'settings' && renderSettingsTab()}

        {/* Bulk Download Modal */}
        {showBulkDialog && (
          <div style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0,0,0,0.5)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 2000
          }}>
            <div style={{
              backgroundColor: 'white',
              borderRadius: '10px',
              padding: '30px',
              width: '500px',
              maxWidth: '90%',
              maxHeight: '90%',
              overflow: 'auto'
            }}>
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '20px'
              }}>
                <h3 style={{
                  fontSize: '20px',
                  fontWeight: 'bold',
                  color: '#2c3e50',
                  margin: 0
                }}>Bulk Download Salary Slips</h3>
                <button
                  style={{
                    backgroundColor: 'transparent',
                    border: 'none',
                    fontSize: '24px',
                    cursor: 'pointer',
                    color: '#7f8c8d'
                  }}
                  onClick={() => setShowBulkDialog(false)}
                  disabled={generationStatus === 'processing'}
                >
                  
                </button>
              </div>
              
              <div style={{ marginBottom: '15px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  fontWeight: '600',
                  color: '#2c3e50'
                }}>Select Month</label>
                <select 
                  style={{
                    padding: '10px',
                    borderRadius: '6px',
                    border: '1px solid #ddd',
                    fontSize: '14px',
                    width: '100%',
                    boxSizing: 'border-box',
                    backgroundColor: 'white'
                  }}
                  value={bulkOptions.month}
                  onChange={(e) => setBulkOptions(prev => ({...prev, month: e.target.value}))}
                >
                  <option value="all">All Months</option>
                  <option value="2024-03">March 2024</option>
                  <option value="2024-02">February 2024</option>
                  <option value="2024-01">January 2024</option>
                </select>
              </div>
              
              <div style={{ marginBottom: '15px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  fontWeight: '600',
                  color: '#2c3e50'
                }}>Format</label>
                <select 
                  style={{
                    padding: '10px',
                    borderRadius: '6px',
                    border: '1px solid #ddd',
                    fontSize: '14px',
                    width: '100%',
                    boxSizing: 'border-box',
                    backgroundColor: 'white'
                  }} 
                  value={bulkOptions.format}
                  onChange={(e) => setBulkOptions(prev => ({...prev, format: e.target.value}))}
                >
                  <option value="zip">ZIP Archive (All PDFs)</option>
                  <option value="pdf">PDF (Individual files)</option>
                  <option value="excel">Excel Summary</option>
                </select>
              </div>
              
              <div style={{ marginBottom: '15px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  fontWeight: '600',
                  color: '#2c3e50'
                }}>
                  <input
                    type="checkbox"
                    checked={bulkOptions.includePassword}
                    onChange={(e) => setBulkOptions(prev => ({...prev, includePassword: e.target.checked}))}
                    style={{ marginRight: '10px' }}
                  />
                  Include passwords in Excel export
                </label>
              </div>
              
              <div style={{ marginBottom: '15px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  fontWeight: '600',
                  color: '#2c3e50'
                }}>Selected Slips: {selectedSlips.length}</label>
                <div style={{ padding: '10px', backgroundColor: '#f8f9fa', borderRadius: '6px', maxHeight: '200px', overflow: 'auto' }}>
                  {bulkOptions.month === 'all' && selectedSlips.length === 0 ? (
                    <p style={{ margin: 0, color: '#7f8c8d', textAlign: 'center' }}>No slips selected. All slips will be included.</p>
                  ) : bulkOptions.month === 'all' ? (
                    selectedSlips.map(slipId => {
                      const slip = salaryData.salarySlips.find(s => s.id === slipId);
                      return (
                        <div key={slipId} style={{ padding: '5px 0', borderBottom: '1px solid #e0e0e0' }}>
                          {slip?.employeeName} - {slip?.month}
                        </div>
                      );
                    })
                  ) : (
                    <p style={{ margin: 0, color: '#7f8c8d', textAlign: 'center' }}>
                      All salary slips for {new Date(bulkOptions.month + '-01').toLocaleString('default', { month: 'long', year: 'numeric' })} will be included
                    </p>
                  )}
                </div>
              </div>
              
              <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                <button
                  style={{
                    padding: '10px 20px',
                    borderRadius: '6px',
                    border: 'none',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '600',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    transition: 'all 0.3s ease',
                    backgroundColor: '#3498db',
                    color: 'white',
                    flex: 1
                  }}
                  onClick={handleBulkDownload}
                  disabled={generationStatus === 'processing'}
                >
                  {generationStatus === 'processing' ? 'Processing...' : 'Download'}
                </button>
                <button
                  style={{
                    padding: '10px 20px',
                    borderRadius: '6px',
                    border: '2px solid #3498db',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '600',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    transition: 'all 0.3s ease',
                    backgroundColor: 'transparent',
                    color: '#3498db',
                    flex: 1
                  }}
                  onClick={() => setShowBulkDialog(false)}
                  disabled={generationStatus === 'processing'}
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Advanced Settings Modal */}
        {showSettingsDialog && (
          <div style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            backgroundColor: 'rgba(0,0,0,0.5)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 2000
          }}>
            <div style={{
              backgroundColor: 'white',
              borderRadius: '10px',
              padding: '30px',
              width: '600px',
              maxWidth: '90%',
              maxHeight: '90%',
              overflow: 'auto'
            }}>
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '20px'
              }}>
                <h3 style={{
                  fontSize: '20px',
                  fontWeight: 'bold',
                  color: '#2c3e50',
                  margin: 0
                }}>Advanced Settings</h3>
                <button
                  style={{
                    backgroundColor: 'transparent',
                    border: 'none',
                    fontSize: '24px',
                    cursor: 'pointer',
                    color: '#7f8c8d'
                  }}
                  onClick={() => setShowSettingsDialog(false)}
                >
                  
                </button>
              </div>
              
              <div style={{ marginBottom: '20px' }}>
                <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Company Logo & Seal</h4>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
                  <div>
                    <label style={{
                      display: 'block',
                      marginBottom: '8px',
                      fontWeight: '600',
                      color: '#2c3e50'
                    }}>Logo URL</label>
                    <input
                      type="text"
                      style={{
                        padding: '10px',
                        borderRadius: '6px',
                        border: '1px solid #ddd',
                        fontSize: '14px',
                        width: '100%',
                        boxSizing: 'border-box',
                        backgroundColor: 'white'
                      }}
                      value={companySettings.logo}
                      onChange={(e) => setCompanySettings(prev => ({...prev, logo: e.target.value}))}
                    />
                    <div style={{ marginTop: '10px' }}>
                      <img src={companySettings.logo} alt="Logo Preview" style={{ width: '60px', height: '60px', objectFit: 'contain' }} />
                    </div>
                  </div>
                  <div>
                    <label style={{
                      display: 'block',
                      marginBottom: '8px',
                      fontWeight: '600',
                      color: '#2c3e50'
                    }}>Seal URL</label>
                    <input
                      type="text"
                      style={{
                        padding: '10px',
                        borderRadius: '6px',
                        border: '1px solid #ddd',
                        fontSize: '14px',
                        width: '100%',
                        boxSizing: 'border-box',
                        backgroundColor: 'white'
                      }}
                      value={companySettings.seal}
                      onChange={(e) => setCompanySettings(prev => ({...prev, seal: e.target.value}))}
                    />
                    <div style={{ marginTop: '10px' }}>
                      <img src={companySettings.seal} alt="Seal Preview" style={{ width: '60px', height: '60px', objectFit: 'contain' }} />
                    </div>
                  </div>
                </div>
              </div>
              
              <div style={{ marginBottom: '20px' }}>
                <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Security Settings</h4>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
                  <div>
                    <label style={{
                      display: 'block',
                      marginBottom: '8px',
                      fontWeight: '600',
                      color: '#2c3e50'
                    }}>Password Strength</label>
                    <select 
                      style={{
                        padding: '10px',
                        borderRadius: '6px',
                        border: '1px solid #ddd',
                        fontSize: '14px',
                        width: '100%',
                        boxSizing: 'border-box',
                        backgroundColor: 'white'
                      }}
                      value={companySettings.defaultPassword}
                      onChange={(e) => setCompanySettings(prev => ({...prev, defaultPassword: e.target.value}))}
                    >
                      <option value="employee_id">Employee ID (Basic)</option>
                      <option value="dob">Date of Birth (Medium)</option>
                      <option value="custom">Custom (Strong)</option>
                    </select>
                  </div>
                  <div>
                    <label style={{
                      display: 'block',
                      marginBottom: '8px',
                      fontWeight: '600',
                      color: '#2c3e50'
                    }}>Retention Period</label>
                    <input
                      type="number"
                      min="1"
                      max="60"
                      style={{
                        padding: '10px',
                        borderRadius: '6px',
                        border: '1px solid #ddd',
                        fontSize: '14px',
                        width: '100%',
                        boxSizing: 'border-box',
                        backgroundColor: 'white'
                      }}
                      value={companySettings.retentionPeriod}
                      onChange={(e) => setCompanySettings(prev => ({...prev, retentionPeriod: parseInt(e.target.value)}))}
                    />
                  </div>
                </div>
              </div>
              
              <div style={{ marginBottom: '20px' }}>
                <h4 style={{ margin: '0 0 15px 0', color: '#2c3e50' }}>Notification Settings</h4>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
                  <div>
                    <label style={{
                      display: 'block',
                      marginBottom: '8px',
                      fontWeight: '600',
                      color: '#2c3e50'
                    }}>Auto-send Time</label>
                    <input
                      type="time"
                      style={{
                        padding: '10px',
                        borderRadius: '6px',
                        border: '1px solid #ddd',
                        fontSize: '14px',
                        width: '100%',
                        boxSizing: 'border-box',
                        backgroundColor: 'white'
                      }}
                      value={notificationSettings.sendTime}
                      onChange={(e) => setNotificationSettings(prev => ({...prev, sendTime: e.target.value}))}
                    />
                  </div>
                  <div>
                    <label style={{
                      display: 'block',
                      marginBottom: '8px',
                      fontWeight: '600',
                      color: '#2c3e50'
                    }}>Revision Period (days)</label>
                    <input
                      type="number"
                      min="1"
                      max="30"
                      style={{
                        padding: '10px',
                        borderRadius: '6px',
                        border: '1px solid #ddd',
                        fontSize: '14px',
                        width: '100%',
                        boxSizing: 'border-box',
                        backgroundColor: 'white'
                      }}
                      value={companySettings.revisionDays}
                      onChange={(e) => setCompanySettings(prev => ({...prev, revisionDays: parseInt(e.target.value)}))}
                    />
                  </div>
                </div>
              </div>
              
              <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                <button
                  style={{
                    padding: '10px 20px',
                    borderRadius: '6px',
                    border: 'none',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '600',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    transition: 'all 0.3s ease',
                    backgroundColor: '#3498db',
                    color: 'white',
                    flex: 1
                  }}
                  onClick={() => {
                    handleUpdateCompanySettings();
                    setShowSettingsDialog(false);
                  }}
                >
                  Save Changes
                </button>
                <button
                  style={{
                    padding: '10px 20px',
                    borderRadius: '6px',
                    border: '2px solid #3498db',
                    cursor: 'pointer',
                    fontSize: '14px',
                    fontWeight: '600',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '8px',
                    transition: 'all 0.3s ease',
                    backgroundColor: 'transparent',
                    color: '#3498db',
                    flex: 1
                  }}
                  onClick={() => setShowSettingsDialog(false)}
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Status Indicator */}
        {generationStatus !== 'idle' && generationStatus !== 'completed' && generationStatus !== 'error' && (
          <div style={{
            position: 'fixed',
            bottom: '20px',
            right: '20px',
            padding: '15px 20px',
            backgroundColor: generationStatus === 'completed' ? '#2ecc71' : 
                            generationStatus === 'error' ? '#e74c3c' : '#3498db',
            color: 'white',
            borderRadius: '8px',
            boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
            display: 'flex',
            alignItems: 'center',
            gap: '10px',
            zIndex: 1000
          }}>
            {generationStatus === 'generating' && <Icon icon="heroicons:arrow-path" className="animate-spin" />}
            {generationStatus === 'downloading' && <Icon icon="heroicons:arrow-down-tray" />}
            {generationStatus === 'sending' && <Icon icon="heroicons:paper-airplane" />}
            {generationStatus === 'distributing' && <Icon icon="heroicons:paper-airplane" />}
            {generationStatus === 'processing' && <Icon icon="heroicons:arrow-path" className="animate-spin" />}
            {generationStatus === 'completed' && <Icon icon="heroicons:check-circle" />}
            {generationStatus === 'error' && <Icon icon="heroicons:x-circle" />}
            <span>
              {generationStatus === 'generating' && 'Generating salary slip...'}
              {generationStatus === 'downloading' && 'Downloading PDF...'}
              {generationStatus === 'sending' && 'Sending email...'}
              {generationStatus === 'distributing' && 'Distributing salary slip...'}
              {generationStatus === 'processing' && 'Processing...'}
              {generationStatus === 'completed' && 'Operation completed!'}
              {generationStatus === 'error' && 'Error occurred!'}
            </span>
          </div>
        )}

        <style>
          {`
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
            
            .animate-spin {
              animation: spin 1s linear infinite;
            }
            
            button:hover:not(:disabled) {
              opacity: 0.9;
              transform: translateY(-2px);
            }
            
            button:active:not(:disabled) {
              transform: translateY(0);
            }
            
            button:disabled {
              opacity: 0.6;
              cursor: not-allowed;
              transform: none;
            }
            
            input[type="checkbox"] {
              cursor: pointer;
            }
            
            select {
              cursor: pointer;
            }
            
            .status-badge {
              padding: 4px 8px;
              border-radius: 12px;
              font-size: 12px;
              font-weight: 600;
              display: inline-block;
            }
            
            .status-distributed {
              background-color: #d4edda;
              color: #155724;
            }
            
            .status-generated {
              background-color: #fff3cd;
              color: #856404;
            }
            
            .status-pending {
              background-color: #f8d7da;
              color: #721c24;
            }
          `}
        </style>
      </div>
    </div>
  );
};

export default Salaryslip;